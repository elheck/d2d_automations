import { Button, LineEdit, ListView, StandardButton, VerticalBox, HorizontalBox, ScrollView, CheckBox, ComboBox } from "std-widgets.slint";

export struct OrderData {
    order_id: string,
    username: string,
    name: string,
    street: string,
    city: string,
    country: string,
    is_professional: string,
    vat_number: string,
    date_of_purchase: string,
    article_count: int,
    merchandise_value: string,
    shipment_costs: string,
    total_value: string,
    commission: string,
    currency: string,
    description: string,
    product_id: string,
    localized_product_name: string,
}

export component Main inherits Window {
    title: "Rechnungserstellung - German Invoice Generator";
    preferred-width: 1200px;
    preferred-height: 800px;
    background: #1e1e1e;

    in-out property <string> csv_file_path: "";
    in-out property <string> starting_invoice_number: "";
    in-out property <string> company_name: "Ihr Firmenname";
    in-out property <string> company_address: "Ihre Adresse\n12345 Ihre Stadt";
    in-out property <string> company_phone: "+49 123 456789";
    in-out property <string> company_email: "info@ihrefirma.de";
    in-out property <[OrderData]> orders: [];
    in-out property <string> status_message: "Bereit für CSV-Import";
    in-out property <bool> processing: false;

    callback load_csv_file();
    callback generate_invoices();
    callback browse_csv_file();

    VerticalBox {
        padding: 20px;
        spacing: 15px;

        // Header
        Text {
            text: "Rechnungserstellung für deutsche Kleinunternehmen";
            font-size: 20px;
            font-weight: 700;
            color: #ffffff;
        }

        // Company Settings Section
        Rectangle {
            background: #2d2d2d;
            border-radius: 8px;
            padding: 15px;
            border-width: 1px;
            border-color: #404040;
            
            VerticalBox {
                spacing: 10px;
                
                Text {
                    text: "Firmeneinstellungen";
                    font-size: 16px;
                    font-weight: 600;
                    color: #ffffff;
                }
                
                HorizontalBox {
                    spacing: 10px;
                    Text { text: "Firmenname:"; min-width: 120px; color: #e0e0e0; }
                    LineEdit {
                        text <=> company_name;
                        placeholder-text: "Ihr Firmenname";
                    }
                }
                
                HorizontalBox {
                    spacing: 10px;
                    Text { text: "Adresse:"; min-width: 120px; color: #e0e0e0; }
                    LineEdit {
                        text <=> company_address;
                        placeholder-text: "Straße, PLZ Stadt";
                    }
                }
                
                HorizontalBox {
                    spacing: 10px;
                    Text { text: "Telefon:"; min-width: 120px; color: #e0e0e0; }
                    LineEdit {
                        text <=> company_phone;
                        placeholder-text: "+49 123 456789";
                    }
                }
                
                HorizontalBox {
                    spacing: 10px;
                    Text { text: "E-Mail:"; min-width: 120px; color: #e0e0e0; }
                    LineEdit {
                        text <=> company_email;
                        placeholder-text: "info@ihrefirma.de";
                    }
                }
            }
        }

        // CSV Import Section
        Rectangle {
            background: #2d2d2d;
            border-radius: 8px;
            padding: 15px;
            border-width: 1px;
            border-color: #404040;
            
            VerticalBox {
                spacing: 10px;
                
                Text {
                    text: "CSV-Import";
                    font-size: 16px;
                    font-weight: 600;
                    color: #ffffff;
                }
                
                HorizontalBox {
                    spacing: 10px;
                    LineEdit {
                        text <=> csv_file_path;
                        placeholder-text: "Pfad zur CSV-Datei...";
                        enabled: !processing;
                    }
                    Button {
                        text: "Durchsuchen";
                        enabled: !processing;
                        clicked => { browse_csv_file(); }
                    }
                    Button {
                        text: "CSV laden";
                        enabled: !processing && csv_file_path != "";
                        clicked => { load_csv_file(); }
                    }
                }
            }
        }

        // Invoice Number Section
        Rectangle {
            background: #2d2d2d;
            border-radius: 8px;
            padding: 15px;
            border-width: 1px;
            border-color: #404040;
            
            VerticalBox {
                spacing: 10px;
                
                Text {
                    text: "Rechnungsnummern";
                    font-size: 16px;
                    font-weight: 600;
                    color: #ffffff;
                }
                
                HorizontalBox {
                    spacing: 10px;
                    Text { 
                        text: "Erste Rechnungsnummer:"; 
                        min-width: 180px; 
                        color: #e0e0e0;
                    }
                    LineEdit {
                        text <=> starting_invoice_number;
                        placeholder-text: "z.B. 2025080001";
                        enabled: !processing;
                    }
                    Text {
                        text: "(Format: JJJJMMNNNN)";
                        color: #a0a0a0;
                    }
                }
            }
        }

        // Orders Preview
        if orders.length > 0: Rectangle {
            background: #2d2d2d;
            border-radius: 8px;
            padding: 15px;
            border-width: 1px;
            border-color: #404040;
            
            VerticalBox {
                spacing: 10px;
                
                HorizontalBox {
                    Text {
                        text: "Geladene Bestellungen: " + orders.length;
                        font-size: 16px;
                        font-weight: 600;
                        color: #ffffff;
                    }
                    Rectangle { } // spacer
                    Button {
                        text: "Rechnungen generieren";
                        enabled: !processing && orders.length > 0 && starting_invoice_number != "";
                        clicked => { generate_invoices(); }
                    }
                }
                
                ScrollView {
                    max-height: 300px;
                    ListView {
                        for order[index] in orders: Rectangle {
                            background: Math.mod(index, 2) == 0 ? #3a3a3a : #404040;
                            height: 30px;
                            border-radius: 3px;
                            
                            HorizontalBox {
                                padding: 5px;
                                spacing: 10px;
                                
                                Text {
                                    text: order.order_id;
                                    min-width: 100px;
                                    font-size: 12px;
                                    color: #ffffff;
                                }
                                Text {
                                    text: order.name;
                                    min-width: 150px;
                                    font-size: 12px;
                                    color: #ffffff;
                                }
                                Text {
                                    text: order.date_of_purchase;
                                    min-width: 120px;
                                    font-size: 12px;
                                    color: #ffffff;
                                }
                                Text {
                                    text: order.total_value + " " + order.currency;
                                    min-width: 80px;
                                    font-size: 12px;
                                    color: #ffffff;
                                }
                                Rectangle { } // spacer
                            }
                        }
                    }
                }
            }
        }

        // Status
        Rectangle {
            background: processing ? #3a2f1a : #1e3a1e;
            border-radius: 8px;
            padding: 10px;
            border-width: 1px;
            border-color: processing ? #5a4f2a : #2e4a2e;
            
            Text {
                text: status_message;
                color: processing ? #ffd700 : #90ee90;
            }
        }
    }
}
